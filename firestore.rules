rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Avis clients
    match /reviews/{reviewId} {

      // Lecture: uniquement les avis approuvés
      allow read: if resource.data.approved == true;

      // Écriture: tout le monde peut envoyer un avis (mais pas l'approuver)
      allow create: if
        request.resource.data.approved == false &&
        request.resource.data.rating is int &&
        request.resource.data.rating >= 1 &&
        request.resource.data.rating <= 5 &&
        request.resource.data.name is string &&
        request.resource.data.name.size() >= 2 &&
        request.resource.data.message is string &&
        request.resource.data.message.size() >= 10 &&
        request.resource.data.message.size() <= 700;

      // Personne ne modifie/supprime depuis le front
      allow update, delete: if false;
    }

    // Tout le reste interdit
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
